<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="ragiroux">
<title>UPGRADE-SCHEDULER API</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>UPGRADE-SCHEDULER API</h1>
<div class="details">
<span id="author" class="author">ragiroux</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#resources-index-access">Get pinot cluster state</a>
<ul class="sectlevel3">
<li><a href="#_request_structure">Request structure</a></li>
<li><a href="#_curl_request">CURL request</a></li>
<li><a href="#_example_response">Example response</a></li>
</ul>
</li>
<li><a href="#_post_add_pinot_cluster_to_the_scheduler">POST add pinot cluster to the scheduler</a>
<ul class="sectlevel3">
<li><a href="#_request_structure_2">Request structure</a></li>
<li><a href="#_curl_request_2">CURL request</a></li>
<li><a href="#_example_response_2">Example response</a></li>
</ul>
</li>
<li><a href="#_put_update_pinot_cluster_information">PUT update pinot cluster information</a>
<ul class="sectlevel3">
<li><a href="#_request_structure_3">Request structure</a></li>
<li><a href="#_curl_request_3">CURL request</a></li>
<li><a href="#_example_response_3">Example response</a></li>
</ul>
</li>
<li><a href="#_post_add_a_new_upgrade">POST add a new upgrade</a>
<ul class="sectlevel3">
<li><a href="#_request_structure_4">Request structure</a></li>
<li><a href="#_curl_request_4">CURL request</a></li>
<li><a href="#_example_response_4">Example response</a></li>
</ul>
</li>
<li><a href="#_post_add_a_new_cluster_state">POST add a new cluster state</a>
<ul class="sectlevel3">
<li><a href="#_request_structure_5">Request structure</a></li>
<li><a href="#_curl_request_5">CURL request</a></li>
<li><a href="#_example_response_5">Example response</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="overview" class="sect0"><a class="link" href="#overview">Overview</a></h1>
<div class="sect2">
<h3 id="resources-index-access"><a class="link" href="#resources-index-access">Get pinot cluster state</a></h3>
<div class="paragraph">
<p>Get the desired state for a cluster. If the version of the cluster is less up to date than the version of the orchestrator then the canary release algorithm will be triggered to rollout the new version to this cluster</p>
</div>
<div class="sect3">
<h4 id="_request_structure"><a class="link" href="#_request_structure">Request structure</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">GET /v1/scheduler/state?clusterId=f319ac01-78ec-4815-bd70-bbc8243b9859 HTTP/1.1
Host: localhost:8080</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_curl_request"><a class="link" href="#_curl_request">CURL request</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl 'http://localhost:8080/v1/scheduler/state?clusterId=f319ac01-78ec-4815-bd70-bbc8243b9859' -i -X GET</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_response"><a class="link" href="#_example_response">Example response</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 260

{"clusterId":"f319ac01-78ec-4815-bd70-bbc8243b9859","updateAt":"2021-04-12T19:46:20.6296817","upgrade":{"id":null,"upgradeName":"CHRISTMAS ELF","version":"1.0.1","summary":null,"patchUri":null,"patchType":"FEATURE"},"nextCallBack":"2021-04-19T19:46:20.630675"}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clusterId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The pinot cluster id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updateAt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time at which the update is scheduled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgrade.id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">upgrade id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgrade.upgradeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">upgrade name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgrade.version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the new version to be upgraded at</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgrade.summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Summary of the upgrade</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgrade.patchUri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">upgrade uri (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgrade.patchType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type of patch, Feature, Bugfix, Security</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nextCallBack</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time at which the pinot cluster should call for a new state</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_post_add_pinot_cluster_to_the_scheduler"><a class="link" href="#_post_add_pinot_cluster_to_the_scheduler">POST add pinot cluster to the scheduler</a></h3>
<div class="paragraph">
<p>Register cluster to scheduler</p>
</div>
<div class="sect3">
<h4 id="_request_structure_2"><a class="link" href="#_request_structure_2">Request structure</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">POST /v1/clusters HTTP/1.1
Content-Type: application/json
Content-Length: 91
Host: localhost:8080

{"clusterId":"cd5b0000-cbf3-4649-aeea-371af9e4c29c","version":"1.0.0","status":"COMPLETED"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_curl_request_2"><a class="link" href="#_curl_request_2">CURL request</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl 'http://localhost:8080/v1/clusters' -i -X POST \
    -H 'Content-Type: application/json' \
    -d '{"clusterId":"cd5b0000-cbf3-4649-aeea-371af9e4c29c","version":"1.0.0","status":"COMPLETED"}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_response_2"><a class="link" href="#_example_response_2">Example response</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 91

{"clusterId":"cd5b0000-cbf3-4649-aeea-371af9e4c29c","version":"1.0.0","status":"COMPLETED"}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clusterId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The pinot cluster id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current managed cluster version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current managed cluster status</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_put_update_pinot_cluster_information"><a class="link" href="#_put_update_pinot_cluster_information">PUT update pinot cluster information</a></h3>
<div class="sect3">
<h4 id="_request_structure_3"><a class="link" href="#_request_structure_3">Request structure</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">PUT /v1/clusters/a0e7fc19-8195-4a61-9c20-0165196aaa95 HTTP/1.1
Content-Type: application/json
Content-Length: 91
Host: localhost:8080

{"clusterId":"a0e7fc19-8195-4a61-9c20-0165196aaa95","version":"1.0.1","status":"UPGRADING"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_curl_request_3"><a class="link" href="#_curl_request_3">CURL request</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl 'http://localhost:8080/v1/clusters/a0e7fc19-8195-4a61-9c20-0165196aaa95' -i -X PUT \
    -H 'Content-Type: application/json' \
    -d '{"clusterId":"a0e7fc19-8195-4a61-9c20-0165196aaa95","version":"1.0.1","status":"UPGRADING"}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_response_3"><a class="link" href="#_example_response_3">Example response</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 91

{"clusterId":"a0e7fc19-8195-4a61-9c20-0165196aaa95","version":"1.0.1","status":"UPGRADING"}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clusterId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The pinot cluster id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current managed cluster version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current managed cluster status</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_post_add_a_new_upgrade"><a class="link" href="#_post_add_a_new_upgrade">POST add a new upgrade</a></h3>
<div class="paragraph">
<p>Add a new patch in the upgrade scheduler</p>
</div>
<div class="sect3">
<h4 id="_request_structure_4"><a class="link" href="#_request_structure_4">Request structure</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">POST /v1/upgrade HTTP/1.1
Content-Type: application/json
Content-Length: 137
Host: localhost:8080

{"id":null,"upgradeName":"UNICORN","version":"1.3.3.7","summary":"Super patch with lots of features","patchUri":"","patchType":"FEATURE"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_curl_request_4"><a class="link" href="#_curl_request_4">CURL request</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl 'http://localhost:8080/v1/upgrade' -i -X POST \
    -H 'Content-Type: application/json' \
    -d '{"id":null,"upgradeName":"UNICORN","version":"1.3.3.7","summary":"Super patch with lots of features","patchUri":"","patchType":"FEATURE"}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_response_4"><a class="link" href="#_example_response_4">Example response</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 134

{"id":8,"upgradeName":"UNICORN","version":"1.3.3.7","summary":"Super patch with lots of features","patchUri":"","patchType":"FEATURE"}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Newly created id for the upgrade</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upgradeName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the pinot upgrade</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quick summary of the upgrade</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patchUri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uri for downloading patch (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patchType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patch type</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_post_add_a_new_cluster_state"><a class="link" href="#_post_add_a_new_cluster_state">POST add a new cluster state</a></h3>
<div class="paragraph">
<p>Link together an upgrade and a deployment strategy</p>
</div>
<div class="sect3">
<h4 id="_request_structure_5"><a class="link" href="#_request_structure_5">Request structure</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">POST /v1/scheduler/state HTTP/1.1
Content-Type: application/json
Content-Length: 76
Host: localhost:8080

{"rolloutStrategy":"PERCENTAGE","rolloutParameter":"20","version":"1.3.3.7"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_curl_request_5"><a class="link" href="#_curl_request_5">CURL request</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl 'http://localhost:8080/v1/scheduler/state' -i -X POST \
    -H 'Content-Type: application/json' \
    -d '{"rolloutStrategy":"PERCENTAGE","rolloutParameter":"20","version":"1.3.3.7"}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_response_5"><a class="link" href="#_example_response_5">Example response</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-http hljs" data-lang="http">HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 76

{"rolloutStrategy":"PERCENTAGE","rolloutParameter":"20","version":"1.3.3.7"}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rolloutStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The canary release strategy to use for the new version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rolloutParameter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The strategy parameter i.e percentage 20%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New version to rollout to managed cluster</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-12 18:37:30 -0400
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>